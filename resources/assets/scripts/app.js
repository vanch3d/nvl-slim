/*
 * A wrapper for all the meaningful site-wide operations
 */

/**
 *
 */
var jNVL = (function (self,$) {

    var	self = {};

    /**
     * Initialise various elements of the main site: pushmenu, go top control, translator, ...
     * Called once on each page
     */
    self.initSite = function()
    {
        // Create the push menu
        new mlPushMenu(document.getElementById('mp-menu'), document.getElementById('trigger'), {
            /*  type : 'cover'*/
        });

        // initialise the "go to top" button
        $('.topcontrol a').click(function () {
            $('html, body, .scroller').animate({scrollTop: '0px'}, 800);
            return false;
        });

        // initialise the translation for bibliography items
        $.i18n.init({
            //ns: { namespaces: ['ns.common', 'ns.special'], defaultNs: 'ns.common'},
            lng: 'dev',
            resGetPath: '/locales/__lng__/__ns__.json',
            useLocalStorage: false,
            debug: false
        }, function () {
            $("span, button").i18n();
        });

        console.log("Site controller loaded")
    };

    /**
     * Check the page for references generated by CSL (csl-title) to insert the URL
     * to the PubReader version (<li data-reader=".....">)
     *
     * @todo[vanch3d] check if this could be done directly at the level of CSL transformation
     */
    self.addPubReaderLinks = function()
    {
        $("[data-reader]").each(function(idx,obj){
            var elt= $(obj).find("span.csl-title");
            if (!elt) return;
            var newLink = $("<a/>", {
                href : $(obj).attr("data-reader"),
                text : elt.text(),
                title : "Read the full text online"
            });
            //@todo[vanch3d] Keep or remove the data once processed?
            //$(obj).removeAttr("data-reader");
            elt.empty().append(newLink);
        });

    }

    return self;

}( jNVL || {}, jQuery ));
